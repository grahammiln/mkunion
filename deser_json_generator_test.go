package mkunion

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestDeSerJsonGeneration(t *testing.T) {
	g := DeSerJsonGenerator{
		Header:      Header,
		Name:        "Vehicle",
		Types:       []string{"Plane", "Car", "Boat"},
		PackageName: "visitor",
	}

	result, err := g.Generate()
	assert.NoError(t, err)
	assert.Equal(t, `// Code generated by mkunion. DO NOT EDIT.
package visitor

import (
	"github.com/widmogrod/mkunion/x/schema"
)

func init() {
	schema.RegisterTransformations(VehicleSchemaTransformations())
	schema.RegisterRules(VehicleSchemaRules())
}

func VehicleSchemaTransformations() []schema.TransformFunc {
	return []schema.TransformFunc{
		schema.WrapStruct(&Plane{}, "Plane"),
		schema.WrapStruct(&Car{}, "Car"),
		schema.WrapStruct(&Boat{}, "Boat"),
	}
}

func VehicleSchemaRules() []schema.RuleMatcher {
	return []schema.RuleMatcher{
        schema.UnwrapStruct(&Plane{}, "Plane"),
        schema.UnwrapStruct(&Car{}, "Car"),
        schema.UnwrapStruct(&Boat{}, "Boat"),
	}
}
`, string(result))
}
