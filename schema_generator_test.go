package mkunion

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestDeSerJsonGeneration(t *testing.T) {
	g := SchemaGenerator{
		Header:      Header,
		Name:        "Vehicle",
		Types:       []string{"Plane", "Car", "Boat"},
		PackageName: "visitor",
	}

	result, err := g.Generate()
	assert.NoError(t, err)
	assert.Equal(t, `// Code generated by mkunion. DO NOT EDIT.
package visitor

import (
	"github.com/widmogrod/mkunion/x/schema"
)

func init() {
	schema.RegisterUnionTypes(VehicleSchemaDef())
}

func VehicleSchemaDef() *schema.UnionVariants[Vehicle] {
	return schema.MustDefineUnion[Vehicle](
		&Plane{},
		&Car{},
		&Boat{},
	)
}
`, string(result))
}
